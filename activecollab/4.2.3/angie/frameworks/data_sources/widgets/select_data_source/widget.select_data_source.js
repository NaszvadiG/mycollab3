jQuery.fn.selectDataSource=function(s){var settings=jQuery.extend({types:null,selected_data_source:null},s);return this.each(function(){var wrapper=$(this);var wrapper_id=wrapper.attr("id");var selected_radio=false;var type_details_wrapper=$('<div class="data_source_types_details"></div>').appendTo(wrapper);var test_connection_button=$("button#test_connection_button");var message_container=$("<span></span>").hide();test_connection_button.after(message_container);var types_wrapper=$('<div class="data_source_types"></div>').prependTo(wrapper);if($.isEmptyObject(settings.types)===false){App.each(settings.types,function(type_class,object){var type_wrapper=$('<div class="data_source_type"></div>').appendTo(types_wrapper);var type_id=wrapper_id+"_"+type_class;var radio=$('<input type="radio" name="data_source[type]" value="'+type_class+'" id="'+type_id+'">');radio.click(function(){var current_type_class=$(this).attr("value");if(type_details_wrapper.attr("currently_selected")==current_type_class){return}type_details_wrapper.empty().append("<h3>"+App.clean(settings.types[current_type_class]["name"])+"</h3>").attr("currently_selected",current_type_class);if(settings.types[current_type_class]["description"]){type_details_wrapper.append('<div class="data_source_type_description">'+settings.types[current_type_class]["description"]+"</div>")}if(settings.types[current_type_class]["options"]){type_details_wrapper.append('<div class="data_source_options">'+settings.types[current_type_class]["options"]+"</div>")}if(settings.types[current_type_class]["can_test_connection"]){test_connection_button.show();test_connection_button.click(function(event){var obj=$(this);var old_label=obj.text();obj.attr("disabled","disabled");obj.text(App.lang("Working..."));var params=new Object();var options=type_details_wrapper.find("input");message_container.hide();App.each(options,function(index,input){params[$(input).attr("test_name")]=$(input).val()});$.ajax({url:App.extendUrl($(this).attr("test_url")),type:"post",data:{source_type:current_type_class,data_source:params,submitted:"submitted"},success:function(response){message_container.html(response).show().removeClass().addClass("test_message_container_success");obj.text(old_label);obj.removeAttr("disabled")},error:function(response){message_container.html(App.Wireframe.Utils.responseToErrorMessage(response)).show().removeClass().addClass("test_message_container_error");obj.text(old_label);obj.removeAttr("disabled")}});event.stopPropagation();return false})}else{test_connection_button.hide()}}).appendTo(type_wrapper);if(settings.selected_data_source&&settings.selected_data_source["type"]==type_class){selected_radio=radio}type_wrapper.append('<label for="'+type_id+'">'+App.clean(settings.types[type_class]["name"])+"</label>")});if(selected_radio){selected_radio.click()}else{types_wrapper.find("input[type=radio]:first").click()}}else{wrapper.append('<p class="empty_page">'+App.lang("There are no defined data sources")+"</p>");$("div.button_holder").hide()}})};