jQuery.fn.importFromBasecamp=function(s){var settings=jQuery.extend({},s);return this.each(function(){var wrapper=$(this);var queue=[];var running=false;var working=$('<span><img src="'+App.Wireframe.Utils.indicatorUrl()+'"> Importing...</span>');var queued=$("<span>Queued...</span>");var imported=$('<span><img src="'+App.Wireframe.Utils.indicatorUrl("ok")+'"> Imported</span>');var import_btns=wrapper.find("button");import_btns.click(function(event){var button=$(this);var action=button.attr("action");var project_id=button.attr("project_id");var parent_id=action;if(project_id){parent_id+="_"+project_id}button.parent().attr("id",parent_id);var step={url:button.attr("step_url"),action:action,project_id:project_id,parent_id:parent_id};button.parent().html(queued.html());queue.push(step);if(!running){execute_step(0)}event.preventDefault();return false});var execute_step=function(step_num){var step=queue[step_num];running=true;var parent_obj=wrapper.find("#"+step.parent_id);parent_obj.html(working.html());$.ajax({url:step.url,type:"post",data:{submitted:"submitted",params:{action:step.action,project_id:step.project_id}},success:function(response){running=false;parent_obj.html(imported.html());var next_step=step_num+1;if(next_step<queue.length){execute_step(next_step)}else{queue=[]}},error:function(response){parent_obj.html('<span><img src="'+App.Wireframe.Utils.indicatorUrl("error")+'"> '+App.Wireframe.Utils.responseToErrorMessage(response)+"</span>");running=false;queue=[]}})}})};