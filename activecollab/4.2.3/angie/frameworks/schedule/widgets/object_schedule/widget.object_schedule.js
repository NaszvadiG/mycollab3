(function($){var public_methods={init:function(options){return this.each(function(){var wrapper=$(this);var wrapper_dom=this;var start_on=options.start_on;var due_on=options.due_on;var label=get_label(options.start_on,options.due_on);if(options.show_label){var label_span=$('<span class="scheduled_label">'+label+"</span>").appendTo(wrapper);wrapper.append(" ")}if(options.can_reschedule){var anchor=$('<a href="'+options.reschedule_url+'" title="'+label+'"></a>').appendTo(wrapper);var icon=$('<img src="'+get_icon_url.apply(this,[options.start_on||options.due_on])+'" />').appendTo(anchor);anchor.flyoutForm({width:"narrow",title:App.lang("Reschedule"),success_event:options.event_name})}else{var icon=$('<img src="'+get_icon_url.apply(this,[options.start_on||options.due_on])+'" />').appendTo(wrapper)}App.Wireframe.Events.bind(options.listen_events.join(" "),function(event,object){if(object.id!=options.object_id){return false}var has_changed=false;if(object.type=="Milestone"){if((start_on&&!object.start_on)||(!start_on&&object.start_on)||start_on&&object.start_on&&start_on.timestamp!=object.start_on.timestamp){has_changed=true}}if((due_on&&!object.due_on)||(!due_on&&object.due_on)||due_on&&object.due_on&&due_on.timestamp!=object.due_on.timestamp){has_changed=true}if(!has_changed){return true}start_on=object.start_on;due_on=object.due_on;var label=get_label(object.start_on,object.due_on);if(options.show_label){label_span.text(label)}if(options.can_reschedule){anchor.attr("title",label);if(event.type.indexOf("_updated")>0){if(object.type=="Milestone"){App.widgets.MilestoneDateRange.set("milestone_date_range_"+object.id,{start_date:object.start_on,end_date:object.due_on});App.Wireframe.Flash.success("Milestone has been rescheduled")}else{App.Wireframe.Flash.success("Due date for the :object_type has been updated",{object_type:object.type.toLowerCase()})}}}icon.attr("src",get_icon_url(object.start_on||object.due_on))});return true})}};var get_label=function(start_on,due_on){if(due_on&&start_on){return start_on.formatted_date_gmt+" - "+due_on.formatted_date_gmt}else{if(start_on){return start_on.formatted_date_gmt}else{if(due_on){return due_on.formatted_date_gmt}else{return App.lang("Not scheduled")}}}};var get_icon_url=function(scheduled){if(scheduled){return App.Wireframe.Utils.imageUrl("object-schedule-active.png","schedule")}else{return App.Wireframe.Utils.imageUrl("object-schedule-inactive.png","schedule")}};var plugin_name="objectSchedule";$.fn[plugin_name]=function(method){if(public_methods[method]){return public_methods[method].apply(this,Array.prototype.slice.call(arguments,1))}else{if(typeof method==="object"||!method){return public_methods.init.apply(this,arguments)}else{$.error("Method "+method+" does not exist in jQuery."+plugin_name)}}}})(jQuery);