jQuery.fn.selectPaymentGateway=function(s){var settings=jQuery.extend({types:null,object_info:null,is_public:null,logged_user:null,payment_data:null},s);return this.each(function(){var wrapper=$(this);var wrapper_id=wrapper.attr("id");var selected_radio=false;var type_details_wrapper=$('<div class="payments_gateway_types_details"></div>').appendTo(wrapper);if(settings.edit_mode!=true){var types_wrapper=$('<div class="payments_gateway_types"></div>').prependTo(wrapper);if($.isEmptyObject(settings.types)===false){types_wrapper.append($("<p>"+App.lang("Select preferred payment option:")+"</p>"));App.each(settings.types,function(type_class,object){var type_id=wrapper_id+"_"+type_class;var type_wrapper=$('<div class="payment_gateway_type" id="type_row_'+type_class+'"></div>').appendTo(types_wrapper);var radio=$('<input type="radio" name="payment_gateway[type]" value="'+type_class+'" id="'+type_id+'">');radio.click(function(){var current_type_class=$(this).attr("value");wrapper.find("div.payment_gateway_type").removeClass("selected");wrapper.find("div#type_row_"+current_type_class).addClass("selected");if(type_details_wrapper.attr("currently_selected")==current_type_class){return}type_details_wrapper.empty().append("<h3>"+App.clean(settings.types[current_type_class]["name"])+"</h3>").attr("currently_selected",current_type_class);if(settings.types[current_type_class]["description"]){type_details_wrapper.append('<div class="payment_gateway_type_description">'+settings.types[current_type_class]["description"]+"</div>")}if(settings.types[current_type_class]["options"]){var type_options=type_details_wrapper.append('<div class="payment_gateway_options"></div>');var type_form=type_options.append(settings.types[current_type_class]["options"]);if(settings.is_public){var payer_email="";if(settings.payment_data&&settings.payment_data.payer_email){payer_email=settings.payment_data.payer_email}else{if(settings.logged_user){payer_email=settings.logged_user.email}}var payer_email_container=$('<div class="control_holder"><label for="email" class="main_label">'+App.lang("Your Email")+': *</label><input type="email" class="text_field" id="email" value="'+payer_email+'" name="payment[payer_email]" required></div>');type_form.find(".payment_user_form").prepend(payer_email_container);if(settings.logged_user){payer_email_container.append('<p class="aid">'+App.lang("You are logged in as :name",{name:settings.logged_user.display_name})+"</p>")}}}}).appendTo(type_wrapper);if(object.selected==true){selected_radio=radio}type_wrapper.append('<label for="'+type_id+'">'+App.clean(settings.types[type_class]["name"])+"</label>")});if(selected_radio){selected_radio.click()}else{types_wrapper.find("input[type=radio]:first").click()}if(settings.is_public===true){var invoice_thumb=$('<div class="invoice_thumb"><img src="'+App.Wireframe.Utils.imageUrl("public-invoice/public-invoice.png","invoicing")+'"/></div>').appendTo(types_wrapper);var invoice_info_block=$('<div class="invoice_info_block"><div class="invoice_info_item"><label>'+App.lang("Invoice No:")+'</label><div class="invoice_info_value">'+settings.object_info.short_name+'</div></div><div class="invoice_info_item"><label>'+App.lang("Amount Paid:")+'</label><div class="invoice_info_value">'+App.moneyFormat(settings.object_info.paid_amount,settings.object_info.currency,null,true)+'</div></div><div class="invoice_info_item"><label>'+App.lang("Total Cost:")+'</label><div class="invoice_info_value">'+App.moneyFormat(settings.object_info.total,settings.object_info.currency,null,true)+"</div></div></div>").appendTo(types_wrapper)}}else{wrapper.append('<p class="empty_page">'+App.lang("There are no defined payment options")+"</p>");$("div.button_holder").hide()}}else{type_details_wrapper.empty().append("<h3>"+App.clean(settings.types[0]["name"])+"</h3>");if(settings.types[0]["description"]){type_details_wrapper.append('<div class="payment_gateway_type_description">'+settings.types[0]["description"]+"</div>")}if(settings.types[0]["options"]){type_details_wrapper.append('<div class="payment_gateway_options">'+settings.types[0]["options"]+"</div>")}}})};