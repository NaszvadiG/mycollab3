jQuery.fn.quickSearch=function(s){var settings=jQuery.extend({target:null,rows:"tr",search_index_attribute:"_search_index",success:null},s);var select_next_row=function(){var visible_rows=settings.target.find(settings.rows+":visible");var selected_rows=settings.target.find(".quick_search_row_marker");if(selected_rows.length===0){$(visible_rows[0]).addClass("quick_search_row_marker")}else{selected_rows.removeClass("quick_search_row_marker");var selected_index=visible_rows.index(selected_rows[0]);var next_row_index=selected_index+1>=visible_rows.length?selected_index:selected_index+1;var next_row=$(visible_rows[next_row_index]);next_row.addClass("quick_search_row_marker")}};var select_previous_row=function(){var visible_rows=settings.target.find(settings.rows+":visible");var selected_rows=settings.target.find(".quick_search_row_marker");if(selected_rows.length!==0){selected_rows.removeClass("quick_search_row_marker");var selected_index=visible_rows.index(selected_rows[0]);var previous_row_index=selected_index-1<=0?0:selected_index-1;var previous_row=$(visible_rows[previous_row_index]);previous_row.addClass("quick_search_row_marker")}};var toggle_input_in_row=function(){var selected_row_input=settings.target.find("tr.quick_search_row_marker:visible:first input");if(selected_row_input.attr("type")==="checkbox"){selected_row_input.trigger("click")}else{if(selected_row_input.attr("type")==="radio"){selected_row_input.trigger("click")}}};return this.each(function(){var input=$(this);var target=$(settings.target);input.attr("autocomplete","off");input.addClass("quick_search_textbox");if(target.length>0){var search_timeout;var applied_query="";var do_search=function(){if(search_timeout){clearInterval(search_timeout)}var selector="";var query=jQuery.trim(input.val().toLowerCase().replace(/\"/g,""));if(query==applied_query){return}else{applied_query=query;App.each(query.split(" "),function(index,search_fragment){if(search_fragment){selector+="["+settings.search_index_attribute+'*="'+search_fragment+'"]'}});target.each(function(){$(this).find(settings.rows).hide();$(this).find(settings.rows+selector).show();if(typeof(settings.success)=="function"){settings.success.apply(input[0],[$(this)])}})}};input.bind("click keydown",function(event){if(event.type=="keydown"&&event.keyCode==27){input.blur().attr("value","").focus();do_search()}else{if(event.type=="keydown"&&event.keyCode==13){do_search()}else{if(event.type=="keydown"&&event.keyCode==38){select_previous_row();event.preventDefault()}else{if(event.type=="keydown"&&event.keyCode==40){select_next_row();event.preventDefault()}else{if(event.type=="keydown"&&event.keyCode==32){toggle_input_in_row();event.preventDefault()}else{if(search_timeout){clearTimeout(search_timeout)}search_timeout=setTimeout(do_search,300)}}}}}})}})};