(function($){var public_methods={init:function(options){return this.each(function(){var _this=this;var $this=$(this);var variables=_variables($this);var storage=_storage($this);variables.settings=$.extend({},settings,options||{});variables.properties=[];draw_initial_wireframe.apply(_this);if(variables.settings.filtering&&variables.settings.filtering.length){init_filtering.apply(_this)}if(variables.settings.grouping&&variables.settings.grouping.length){init_grouping.apply(_this)}if(variables.settings.reorder_url){init_reordering.apply(_this)}if(variables.settings.additional_buttons){init_additional_buttons.apply(_this)}if(variables.settings.print_url){init_printing.apply(_this)}init_options_and_search.apply(_this);storage.items=$("<div></div>");if(typeof(variables.settings.items)=="object"&&variables.settings.items){import_items.apply(_this,[variables.settings.items])}init_viewing.apply(_this);delete variables.settings.items;update_items_list.apply(_this);if(!variables.settings.id){variables.settings.id="objects_list"+$.now()}variables.settings.page_url=window.location.href;variables.settings.page_title=App.Wireframe.PageTitle.get();variables.settings.is_touch_device=App.isTouchDevice();init_history.apply(_this)})},add_item:function(item,prepare_item,skip_loading){prepare_item=prepare_item===undefined?true:prepare_item;return this.each(function(){add_item.apply(this,[item,prepare_item,skip_loading])})},add_item_after:function(item,prepare_item,after_id){prepare_item=prepare_item===undefined?true:prepare_item;return this.each(function(){if(!after_id){add_item.apply(this,[item])}else{add_item_after.apply(this,[item,prepare_item,after_id])}})},update_item:function(item,prepare_item){prepare_item=prepare_item===undefined?true:prepare_item;return this.each(function(){update_item.apply(this,[item,prepare_item])})},delete_item:function(item,prepare_item){prepare_item=prepare_item===undefined?true:prepare_item;return this.each(function(){delete_item.apply(this,[item,prepare_item])})},delete_selected_item:function(empty_wrapper){var selected_item=get_selection.apply(this);if(selected_item&&selected_item[0]){return this.each(function(){delete_item.apply(this,[selected_item[0],true]);if(empty_wrapper!==false&&is_loaded.apply(this,[selected_item[0],false])){load_empty.apply(this)}})}},grouping_map_get:function(grouping_id){return get_grouping.apply(this.eq(0),[grouping_id])},grouping_map_add_item:function(grouping_id,item_id,item){return this.each(function(){grouping_map_add_item.apply(this,[grouping_id,item_id,item])})},grouping_map_update_item:function(grouping_id,item_id,item){return this.each(function(){grouping_map_update_item.apply(this,[grouping_id,item_id,item])})},grouping_map_delete_item:function(grouping_id,item_id){return this.each(function(){grouping_map_delete_item.apply(this,[grouping_id,item_id])})},grouping_map_replace:function(grouping_id,new_map){return this.each(function(){grouping_map_replace.apply(this,[grouping_id,new_map])})},load_empty:function(){return this.each(function(){load_empty.apply(this)})},load_item:function(item_id,permalink){return this.each(function(){load_item.apply(this,[item_id,permalink])})},load_group:function(grouping_id,group_id,permalink){return this.each(function(){load_group.apply(this,[grouping_id,group_id,permalink])})},get_selection:function(){return get_selection.apply(this[0])},get_item:function(id){return get_item.apply(this[0],[id])},is_selected:function(id){return is_selected.apply(this[0],[id])},is_loaded:function(id,is_group){return is_loaded.apply(this[0],[id,is_group])},refresh:function(){return this.each(function(){refresh.apply(this)})},reload_current:function(){return reload_current.apply(this[0])}};var import_items=function(items){var _this=this;var $this=$(this);var storage=_storage($this);storage.items.empty();$.each(items,function(item_index,item_value){storage.items.append(render_item.apply(_this,[item_value]))})};var item_matches_requirements=function(item){var _this=this;var $this=$(this);var variables=_variables($this);if(!variables.settings.requirements||$.isEmptyObject(variables.settings.requirements)){return true}var matches_requirements=true;$.each(variables.settings.requirements,function(requirement_name,requirement_value){if(item[requirement_name]!=requirement_value){matches_requirements=false;return false}});return matches_requirements};var init_history=function(){var _this=this;var $this=$(this);var variables=_variables($this);App.Wireframe.Events.bind("history_state_changed.content",function(event){var state=History.getState();var handler=state.data.handler;var handler_id=state.data.handler_id;if(handler!="objects_list"){return true}if(variables.settings.id!=handler_id){return true}var url=state.url;var item=state.data.additional?state.data.additional["item"]:null;if(!item){load_empty.apply(_this)}else{if(item.type=="item"){load_item.apply(_this,[item.id,url])}else{load_group.apply(_this,[item.grouping,item.id,url])}}History.handled=true;return false})};var init_listening=function(){var _this=this;var $this=$(this);var variables=_variables($this);if(variables.settings.listen.add&&variables.settings.listen.add.length){var bind=[];$.each(variables.settings.listen.add,function(index,event_name){bind.push($.trim(event_name+".content"))});App.Wireframe.Events.bind(bind.join(" "),function(event,item){add_item.apply(_this,[event,item])})}if(variables.settings.listen.update&&variables.settings.listen.update.length){var bind=[];$.each(variables.settings.listen.update,function(index,event_name){bind.push($.trim(event_name+".content"))});App.Wireframe.Events.bind(bind.join(" "),function(event,item){update_item.apply(_this,[event,item])})}if(variables.settings.listen["delete"]&&variables.settings.listen["delete"].length){var bind=[];$.each(variables.settings.listen["delete"],function(index,event_name){bind.push($.trim(event_name+".content"))});App.Wireframe.Events.bind(bind.join(" "),function(event,item){delete_item.apply(_this,[event,item])})}};var check_fields_requirements=function(item,skip_warning){var _this=this;var $this=$(this);var variables=_variables($this);if(variables.settings.required_fileds&&variables.settings.required_fileds.length){var missing_fields=[];$.each(variables.settings.required_fileds,function(index,field){if(item[field]===undefined){missing_fields.push(field)}});if(missing_fields.length){if(!skip_warning){console.error("Cannot add item to the objects list. These fields are missing: "+missing_fields.join(", "))}return false}}return true};var load_item=function(item_id,permalink){var _this=this;var $this=$(this);var variables=_variables($this);var selected_item=variables.objects_list_body.find('tr.objects_list_item[item_id="'+item_id+'"]');if(!selected_item.length){selected_item=get_item.apply(_this,[item_id])}variables.objects_list_body.find("tr.objects_list_item.selected").removeClass("selected");variables.objects_list_body.find("div.object_list_group_head.clickable.selected").removeClass("selected");if(!$.isEmptyObject(selected_item)&&selected_item.length){do_load_single.apply(_this,[selected_item],true)}else{do_load_single.apply(_this,[permalink,item_id,false],true)}if(selected_item.is(":visible")){selected_item.addClass("selected");save_selection.apply(_this)}};var load_group=function(grouping_id,group_id,permalink){var _this=this;var $this=$(this);var variables=_variables($this);var selected_item=null;if(variables.active_grouping==grouping_id){selected_item=variables.objects_list_body.find('div.object_list_group_head.clickable[item_id="'+group_id+'"]')}if(!selected_item||!selected_item.length){var grouping=get_grouping.apply(_this,[grouping_id])}variables.objects_list_body.find("tr.objects_list_item.selected").removeClass("selected");variables.objects_list_body.find("div.object_list_group_head.clickable.selected").removeClass("selected");if(!$.isEmptyObject(selected_item)&&selected_item.length){do_load_single.apply(_this,[selected_item],true)}else{do_load_single.apply(_this,[permalink,group_id,true],true)}if(selected_item&&selected_item.is(":visible")){selected_item.addClass("selected");save_selection.apply(_this)}};var select_item=function(item_id){var _this=this;var $this=$(this);var variables=_variables($this);variables.objects_list_body.find('tr.objects_list_item[item_id="'+item_id+'"]').click()};var select_group=function(grouping_id,group_id){var _this=this;var $this=$(this);var variables=_variables($this);if(!variables.active_grouping==grouping_id){return false}variables.objects_list_body.find('div.object_list_group_head[group_id="'+group_id+'"]').click()};var prepare_item_for_list=function(item){var _this=this;var $this=$(this);var variables=_variables($this);if(variables.settings.prepare_item&&typeof(variables.settings.prepare_item)=="function"){item=variables.settings.prepare_item.apply(_this,[item])}return item};var add_item=function(item,prepare_item,skip_loading){var _this=this;var $this=$(this);var variables=_variables($this);var storage=_storage($this);if(prepare_item){item=prepare_item_for_list.apply(_this,[item])}if(!check_fields_requirements.apply(_this,[item])){return false}if(!item_matches_requirements.apply(this,[item])){return false}storage.items.append(render_item.apply(_this,[item]));update_items_list.apply(_this);if(!skip_loading){select_item.apply(_this,[item.id])}};var add_item_after=function(item,prepare_item,after_id){var _this=this;var $this=$(this);var variables=_variables($this);var storage=_storage($this);if(prepare_item){item=prepare_item_for_list.apply(_this,[item])}if(!check_fields_requirements.apply(_this,[item])){return false}if(!item_matches_requirements.apply(this,[item])){return false}var rendered_item=render_item.apply(_this,[item]);var wanted_element=storage.items.find('tr[item_id="'+after_id+'"]');if(wanted_element.length){wanted_element.after(rendered_item)}else{storage.items.append(rendered_item)}update_items_list.apply(_this);select_item.apply(_this,[item.id])};var update_item=function(item,prepare_item,skip_refresh){var _this=this;var $this=$(this);var variables=_variables($this);var storage=_storage($this);var current_item=storage.items.find("tr[item_id="+item.id+"]");if(prepare_item){item=prepare_item_for_list.apply(_this,[item])}if(!check_fields_requirements.apply(_this,[item])){return false}if(!item_matches_requirements.apply(this,[item])){delete_item.apply(this,[item]);load_empty.apply(this)}if(current_item.length){current_item.after(render_item.apply(_this,[item]));current_item.remove();if(!skip_refresh){update_items_list.apply(_this)}}else{add_item.apply(_this,[item,false,true])}};var get_item=function(id){var _this=this;var $this=$(this);var variables=_variables($this);var storage=_storage($this);var current_item=storage.items.find("tr[item_id="+id+"]");return current_item};var delete_item=function(item,prepare_item,skip_refresh){var _this=this;var $this=$(this);var variables=_variables($this);var storage=_storage($this);var item_id=null;if(typeof(item)=="object"){if(prepare_item){item=prepare_item_for_list.apply(_this,[item])}item_id=item.id}else{item_id=item}if(!item_id){console.error("Item you provided has no valid id")}var current_item=storage.items.find("tr[item_id="+item_id+"]");if(current_item.length){current_item.remove();if(!skip_refresh){update_items_list.apply(_this)}}};var grouping_map_add_item=function(grouping_id,item_id,item){if(!grouping_id||!item_id||!item){return false}var grouping=get_grouping.apply(this,[grouping_id]);if(!grouping){return false}if(grouping.map instanceof App.Map){grouping.map.set(item_id,item)}else{grouping.map[item_id]=item}update_items_list.apply(this);return true};var grouping_map_update_item=function(grouping_id,item_id,item){if(!grouping_id||!item_id||!item){return false}var grouping=get_grouping.apply(this,[grouping_id]);if(!grouping){return false}if(grouping.map instanceof App.Map){grouping.map.set(item_id,item)}else{grouping.map[item_id]=item}update_items_list.apply(this);return true};var grouping_map_delete_item=function(grouping_id,item_id){if(!grouping_id||!item_id){return false}var grouping=get_grouping.apply(this,[grouping_id]);if(!grouping){return false}if(grouping.map instanceof App.Map&&grouping.map.isset(item_id)){grouping.map.remove(item_id)}else{delete grouping.map[item_id]}update_items_list.apply(this);return true};var grouping_map_replace=function(grouping_id,new_map){var _this=this;var $this=$(this);var variables=_variables($this);var grouping=get_grouping.apply(this,[grouping_id]);if(!grouping){return false}grouping.map=new_map;update_items_list.apply(this);var grouping_control=variables.objects_list_options.find('li.object_list_grouping input[type="radio"][name="grouping"][value="'+grouping_id+'"]');var grouping_control_wrapper=grouping_control.parents("li:first");if($.isEmptyObject(new_map)){grouping_control.attr("disabled",true);grouping_control_wrapper.addClass("disabled");if(grouping_control.is(":checked")){var first_available_grouping=variables.objects_list_options.find('li.object_list_grouping input[type="radio"][name="grouping"]:not(:disabled):first').click()}}else{grouping_control.attr("disabled",false);grouping_control_wrapper.removeClass("disabled")}var mass_control=variables.multi_form.find('select[name="'+grouping_id+'"]');if(mass_control.length){var current_value=mass_control.val();var first_option=mass_control.find("option:first");var none_one=!first_option.val()||first_option.val()=="0"?first_option:null;var new_one=mass_control.find("option.new_object_option");mass_control.empty();App.each(new_map,function(value,title){mass_control.append('<option value="'+value+'" class="object_option">'+App.clean(title)+"</option>")});if(none_one&&none_one.length){mass_control.prepend('<option value=""></option>');mass_control.prepend(none_one)}if(new_one.length){mass_control.append('<option value=""></option>');mass_control.append(new_one)}if(!current_value){mass_control.find("option").each(function(){var option=$(this);if(option.attr("value")!=""&&option.attr("value")!=0){option.attr("selected",true);return false}})}else{mass_control.val(current_value)}}return true};var get_grouping=function(grouping_id){var _this=this;var $this=$(this);var variables=_variables($this);for(var index in variables.settings.grouping){if(variables.settings.grouping[index].property==grouping_id){return variables.settings.grouping[index]}}return false};var init_viewing=function(){var _this=this;var $this=$(this);var variables=_variables($this);load_empty.apply(_this);variables.active_selection=[];variables.objects_list_body.delegate("tr.objects_list_item","click",function(event){var anchor=$(event.target).parents("*").andSelf().filter("a:first");if(!anchor.length){click_item.apply(_this,[event,$(this)])}});variables.objects_list_body.delegate("div.object_list_group_head.clickable","click",function(event){click_group.apply(_this,[event,$(this)])})};var click_item=function(event,row){var _this=this;var $this=$(this);var variables=_variables($this);if($this.is(".reorder_mode")){return true}if(!App.canNavigateAway()){return false}if(!variables.settings.is_touch_device){variables.objects_list_search_filter.focus()}variables.objects_list_body.find("div.object_list_group_head.clickable.selected").removeClass("selected");var ctrlKey=event.ctrlKey;if($.platform.mac){ctrlKey=event.metaKey}if(ctrlKey){if(row.is(".selected")){row.removeClass("selected");trigger_event.apply(_this,["item_deselected",[row]]);if(variables.active_selection.length==1){load_empty.apply(_this)}else{if(variables.active_selection.length==2){var current_item=variables.objects_list_body.find("tr.objects_list_item.selected:first");load_single.apply(_this,[current_item])}else{load_multi.apply(_this)}}}else{row.addClass("selected");trigger_event.apply(_this,["item_selected",[row]]);if(variables.active_selection.length==0){var current_item=variables.objects_list_body.find("tr.objects_list_item.selected:first");load_single.apply(_this,[current_item])}else{load_multi.apply(_this)}}}else{if(!row.is(".selected")||variables.active_selection.length>1){variables.objects_list_body.find("tr.objects_list_item.selected").removeClass("selected");row.addClass("selected");mark_single_row.apply(_this,[row]);trigger_event.apply(_this,["item_selected",[row]]);load_single.apply(_this,[row])}else{variables.objects_list_body.find("tr.objects_list_item.selected").removeClass("selected");trigger_event.apply(_this,["item_deselected",[row]]);load_empty.apply(_this)}}save_selection.apply(_this)};var click_group=function(event,group){var ctrlKey=event.ctrlKey;if($.platform.mac){ctrlkey=event.metaKey}if(ctrlKey){}var _this=this;var $this=$(this);var variables=_variables($this);variables.objects_list_body.find("tr.objects_list_item.selected").removeClass("selected");variables.active_selection=[];if(group.is(".selected")){variables.objects_list_body.find("div.object_list_group_head.clickable.selected").removeClass("selected");load_empty.apply(_this)}else{variables.objects_list_body.find("div.object_list_group_head.clickable.selected").removeClass("selected");group.addClass("selected");load_single.apply(_this,[group])}};var save_selection=function(){var _this=this;var $this=$(this);var variables=_variables($this);variables.active_selection=[];var selected_items=variables.objects_list_body.find("tr.objects_list_item.selected");selected_items.each(function(){variables.active_selection.push(this.getAttribute("item_id"))});variables.active_group_selection=null;var selected_group=variables.objects_list_body.find(".object_list_group_head.clickable.selected:first");if(selected_group.length){variables.active_group_selection=selected_group.attr("item_id")}variables.settings.selected_items_num=selected_items.length;variables.multi_title.html(App.lang(variables.settings.multi_title,{num:selected_items.length}))};var restore_selection=function(){var _this=this;var $this=$(this);var variables=_variables($this);if(variables.active_selection&&variables.active_selection.length){var query=[];$.each(variables.active_selection,function(index,item_id){query.push("tr[item_id="+item_id+"]")});var matching_objects=variables.objects_list_body.find(query.join(",")).addClass("selected");if(matching_objects.length==0){if(!variables.view_wrapper.is(".empty")&&!variables.view_wrapper.is(".single")){load_empty.apply(_this)}}else{if(matching_objects.length==1){if(!variables.view_wrapper.is(".single")){load_single.apply(_this,[matching_objects])}}else{if(!variables.view_wrapper.is(".multi")){load_multi.apply(_this)}}}save_selection.apply(_this)}else{if(variables.active_group_selection){var selected_group=variables.objects_list_body.find('.object_list_group_head.clickable[item_id="'+variables.active_group_selection+'"]');if(selected_group.length){selected_group.addClass("selected");if(!variables.view_wrapper.is(".single")){load_single.apply(_this,[selected_group])}}}}};var get_selection=function(){var _this=this;var $this=$(this);var variables=_variables($this);return variables.active_selection};var load_empty=function(){var _this=this;var $this=$(this);var variables=_variables($this);App.Wireframe.Events.unbind(".single");App.Wireframe.Events.unbind(".inline_tab");window.soft_refreshed=false;variables.loaded_item=null;variables.view_wrapper.removeClass("multi single").addClass("empty");variables.empty_wrapper.show();variables.single_wrapper.empty().hide();variables.multi_wrapper.hide();variables.objects_list_body.find("tr.objects_list_item.selected").removeClass("selected");App.Wireframe.Events.restore(variables.empty_page_events);trigger_event.apply(_this,["empty"]);cancel_single_loading.apply(_this)};var load_single=function(item){var _this=this;var $this=$(this);var variables=_variables($this);var item_id=item.attr("item_id");var url=item.attr("permalink");if(item.is("tr")){var parsed_item={id:item_id,type:"item"}}else{var parsed_item={id:item_id,type:"group",grouping:item.attr("grouping_property")}}window.soft_refreshed=false;History.pushState({handler:"objects_list",handler_id:variables.settings.id,additional:{item:parsed_item}},App.lang("Loading"),item.attr("permalink"));if(variables.item_currently_loading!=item_id){do_load_single.apply(_this,[item])}};var do_load_single=function(item,item_id,is_group){var _this=this;var $this=$(this);var variables=_variables($this);if(typeof(item)=="object"){var item_id=item.attr("item_id");var is_group=!item.is("tr");var url=item.attr("permalink")}else{var item_id=item_id;var is_group=is_group;var url=item}cancel_single_loading.apply(_this);variables.item_currently_loading=item_id;App.Wireframe.LoadingIndicator.show();variables.loader=$.ajax({url:url,decorate_url:{single:1},type:"get",success:function(response){App.Wireframe.Events.unbind(".single");variables.empty_wrapper.hide();variables.multi_wrapper.hide();variables.single_wrapper.empty().show().html(response);variables.view_wrapper.removeClass("multi empty").addClass("single").scrollTop(0);if(item_id!==false){if(is_group){var item_loaded=variables.objects_list_body.find('div.object_list_group_head[item_id="'+item_id+'"]')}else{var item_loaded=variables.objects_list_body.find('tr.objects_list_item[item_id="'+item_id+'"]')}trigger_event.apply(_this,["single_loaded",[item_loaded.eq(0)]])}else{trigger_event.apply(_this,["single_loaded",[null]])}cancel_single_loading.apply(_this);variables.loaded_item={item_id:item_id,is_group:is_group,url:url};App.Wireframe.Events.trigger("single_content_updated",[variables.single_wrapper[0],{item_id:item_id,is_group:is_group,url:url}]);App.Wireframe.LoadingIndicator.hide()},error:function(response,response_text){trigger_event.apply(_this,["single_loaded",[variables.objects_list_body.find("tr.selected").eq(0)]]);cancel_single_loading.apply(_this)}});trigger_event.apply(_this,["single"])};var cancel_single_loading=function(){var _this=this;var $this=$(this);var variables=_variables($this);App.Wireframe.LoadingIndicator.hide();variables.item_currently_loading=null;if(variables.loader){variables.loader.abort();variables.loader=null}};var load_multi=function(){var _this=this;var $this=$(this);var variables=_variables($this);App.Wireframe.Events.unbind(".single");variables.view_wrapper.removeClass("empty single").addClass("multi");variables.empty_wrapper.hide();variables.single_wrapper.empty().hide();variables.multi_wrapper.show();variables.loaded_item=null;trigger_event.apply(_this,["multi"]);cancel_single_loading.apply(_this)};var init_printing=function(){var _this=this;var $this=$(this);var variables=_variables($this);var print_button=$('<li class="object_list_option object_list_print_option" title="'+App.lang("Print")+'"><span class="object_list_option_button">'+App.lang("Print")+"</span></li>").appendTo(variables.objects_list_options);print_button.click(function(){if(print_button.is(".disabled")){return false}var print_url=App.extendUrl(variables.settings.print_url,{group_by:variables.active_grouping,filter_by:variables.active_filters});App.Wireframe.Print.doPrint(print_url);return false})};var add_filter=function(property,value,skip_refresh){var _this=this;var $this=$(this);var variables=_variables($this);variables.active_filters[property]=value;if(!skip_refresh){update_items_list.apply(_this,[false])}};var remove_filter=function(property,skip_refresh){var _this=this;var $this=$(this);var variables=_variables($this);delete variables.active_filters[property];if(!skip_refresh){update_items_list.apply(_this,[false])}};var init_filtering=function(){var _this=this;var $this=$(this);var variables=_variables($this);init_breadcrumbs.apply(_this);variables.active_filters={};$.each(variables.settings.filtering,function(filter_index,filter){if($.inArray(filter.property,variables.properties)==-1){variables.properties.push(filter.property)}var default_filtering;var group_dropdown='<li class="object_list_option with_dropdown" title="'+App.lang("Filter By :property_name",{property_name:filter.label})+'"><span class="object_list_option_button">'+App.lang("Filter By :property_name",{property_name:filter.label})+'</span><div class="object_list_option_dropdown"><p class="object_list_option_label">'+App.lang("Filter By :property_name",{property_name:filter.label})+"</p><ul>";$.each(filter.values,function(value_index,filter_value){group_dropdown+='<li><label><input type="radio" name="'+filter.property+'" value="'+filter_value.value+'" class="filter" icon="'+filter_value.icon+'" breadcrumbs="'+filter_value.breadcrumbs+'" />'+filter_value.label+"</label></li>";if(filter_value["default"]==true){default_filtering=filter_value.value;add_filter.apply(_this,[filter.property,filter_value.value,true]);breadcrumbs_update_last.apply(_this,[filter_value.breadcrumbs])}});group_dropdown+="</ul></div></li>";group_dropdown=$(group_dropdown);var saved_filtering=get_cookie.apply(_this,["filtering_"+filter.property]);var current_filtering=saved_filtering===false?default_filtering:saved_filtering;group_dropdown.find("input[type=radio][value="+current_filtering+"]").attr("checked",true);add_filter.apply(_this,[filter.property,current_filtering,true]);var checked_radio=group_dropdown.find("input[type=radio]:checked:last");if(checked_radio.length){checked_radio.parents(".object_list_option.with_dropdown").find(".object_list_option_button").css("background-image","url("+checked_radio.attr("icon")+")");breadcrumbs_update_last.apply(_this,[checked_radio.attr("breadcrumbs")])}variables.objects_list_options.append(group_dropdown)})};var init_additional_buttons=function(){var _this=this;var $this=$(this);var variables=_variables($this);if(variables.settings.additional_buttons){$.each(variables.settings.additional_buttons,function(button_id,button){var additional_button=$('<li class="object_list_option" id="'+button_id+'" title="'+button.title+'"><span class="object_list_option_button" >'+button.title+"</span></li>");var additional_button_span=additional_button.find("span:first").css("background-image","url("+button.icon+")");variables.objects_list_options.append(additional_button);if(button.onclick){additional_button.click(function(event){button.onclick.apply(this);event.stopPropagation();return false})}})}};var init_breadcrumbs=function(){var _this=this;var $this=$(this);var variables=_variables($this);variables.breadcrumbs={};variables.breadcrumbs.initial=$("ul#breadcrumbs").clone();variables.breadcrumbs.default_value=$("ul#breadcrumbs li:last").text()};var breadcrumbs_update_last=function(value){var _this=this;var $this=$(this);var variables=_variables($this);if(value=="undefined"){value=variables.breadcrumbs.default_value}variables.breadcrumbs.initial.find("li:last").html("<span class='current'>"+value+"</span>");$("ul#breadcrumbs").html(variables.breadcrumbs.initial.clone().children())};var set_cookie=function(type,value){var _this=this;var $this=$(this);var variables=_variables($this);if(!type){return true}var cookie_content=$.trim($.cookie("ac_objects_lists"));if(!cookie_content){cookie_content={}}else{cookie_content=$.parseJSON(cookie_content)}if(!cookie_content[variables.settings.objects_type]){cookie_content[variables.settings.objects_type]={}}cookie_content[variables.settings.objects_type][type]=value;$.cookie("ac_objects_lists",$.toJSON(cookie_content),{expires:90})};var get_cookie=function(type){var _this=this;var $this=$(this);var variables=_variables($this);if(!type){return false}var cookie_content=$.trim($.cookie("ac_objects_lists"));if(!cookie_content){return false}cookie_content=$.parseJSON(cookie_content);if(cookie_content[variables.settings.objects_type]&&((cookie_content[variables.settings.objects_type][type]!==undefined)&&(cookie_content[variables.settings.objects_type][type]!==false))){return cookie_content[variables.settings.objects_type][type]}return false};var update_grouping=function(grouping,new_mapping){var _this=this;grouping.map=new_mapping;update_items_list.apply(_this)};var init_grouping=function(){var _this=this;var $this=$(this);var variables=_variables($this);var default_grouping;var active_grouping;var group_dropdown='<li class="object_list_option with_dropdown object_list_grouping" title="'+App.lang("Group By")+'"><span class="object_list_option_button">'+App.lang("Group By")+'</span><div class="object_list_option_dropdown"><p class="object_list_option_label">'+App.lang("Group By")+"</p><ul>";$.each(variables.settings.grouping,function(index,current){if(current instanceof App.Map||jQuery.isArray(current)){var is_disabled=(current.length===0)}else{var is_disabled=(current.map===null)}variables.properties.push(current.property);group_dropdown+="<li"+(is_disabled?' class="disabled" ':"")+'><label><input type="radio" name="grouping" value="'+current.property+'" icon="'+current.icon+'"'+(current.map===null?' disabled="disabled" ':"")+" />"+current.label+"</label></li>";if(current.listen){App.Wireframe.Events.bind(current.listen+".content",function(event,new_mapping){update_grouping.apply(_this,[current,new_mapping])})}if(current["default"]==true){default_grouping=current.property;set_grouping.apply(_this,[current.property,true])}});group_dropdown+="</ul></div></li>";group_dropdown=$(group_dropdown);var saved_grouping=get_cookie.apply(_this,["grouping"]);var current_grouping=saved_grouping===false?default_grouping:saved_grouping;var current_grouping_exists=false;$.each(variables.settings.grouping,function(index,current){if(current.property==current_grouping){current_grouping_exists=true}});if(!current_grouping_exists){current_grouping=default_grouping}group_dropdown.find("input[type=radio][value="+current_grouping+"]").attr("checked",true);set_grouping.apply(_this,[current_grouping,true]);var checked_radio=group_dropdown.find("input[type=radio]:checked:last");if(checked_radio.length){checked_radio.parents(".object_list_option.with_dropdown").find(".object_list_option_button").css("background-image","url("+checked_radio.attr("icon")+")")}if(variables.settings.grouping.length<2){group_dropdown.hide()}variables.objects_list_options.append(group_dropdown)};var set_grouping=function(grouping,skip_refresh){var _this=this;var $this=$(this);var variables=_variables($this);variables.active_grouping=grouping;if(!skip_refresh){update_items_list.apply(_this,[false])}};var remove_grouping=function(skip_refresh){var _this=this;var $this=$(this);var variables=_variables($this);variables.active_grouping=null;if(!skip_refresh){update_items_list.apply(_this)}};var init_reordering=function(){var _this=this;var $this=$(this);var variables=_variables($this);var reordering_button=$('<li class="object_list_option object_list_reorder_option" title="'+App.lang("Reorder")+'"><span class="object_list_option_button object_list_reorder_button">'+App.lang("Reorder")+"</span></li>").click(function(){if(reordering_button.is(".opened")){exit_reorder_mode.apply(_this)}else{enter_reorder_mode.apply(_this)}});variables.objects_list_options.append(reordering_button)};var enter_reorder_mode=function(){var _this=this;var $this=$(this);var variables=_variables($this);var storage=_storage($this);variables.objects_list_search_filter.attr("disabled",true).addClass("disabled");variables.objects_list_options.find("li:not(.object_list_reorder_option)").addClass("disabled");$this.addClass("reorder_mode");variables.objects_list_body.empty().append('<table cellspacing="0">'+storage.items.html()+"</table>");variables.objects_list_body.find("tr").each(function(){this.innerHTML='<td class="drag_handle"><img src="'+App.Wireframe.Utils.imageUrl("layout/bits/handle-drag.png","environment")+'" /></td>'+this.innerHTML});var save_timeout;variables.objects_list_body.find("table:first").sortable({items:"tr",axis:"y",forceHelperSize:true,helper:function(e,tr){var $originals=tr.children();var $helper=tr.clone();$helper.children().each(function(index){$(this).width($originals.eq(index).width())});return $helper},update:function(event,ui){if(save_timeout){clearTimeout(save_timeout)}save_timeout=setTimeout(function(){save_ordering.apply(_this)},1000)}})};var save_ordering=function(){var _this=this;var $this=$(this);var variables=_variables($this);var storage=_storage($this);var container=storage.items;var ordered=new Array();container.empty();variables.objects_list_body.find("tr").each(function(){var clone=$(this).clone();ordered.push(clone.attr("item_id"));clone.find("td.drag_handle").remove();clone.appendTo(container)});$.ajax({url:variables.settings.reorder_url,data:{object_ids:ordered,submitted:"submitted"},type:"POST",success:function(response){},error:function(response){}})};var exit_reorder_mode=function(){var _this=this;var $this=$(this);var variables=_variables($this);variables.objects_list_search_filter.attr("disabled",false).removeClass("disabled");variables.objects_list_options.find("li:not(.object_list_reorder_option)").removeClass("disabled");$this.removeClass("reorder_mode");update_items_list.apply(this)};var init_options_and_search=function(){var _this=this;var $this=$(this);var variables=_variables($this);var dropdowns=variables.objects_list_options.find(".object_list_option.with_dropdown").each(function(){var option_dropdown=$(this);option_dropdown.delayedHover(null,function(){option_dropdown.removeClass("opened")},200)});variables.objects_list_options.click(function(event){var target=$(event.target);var target_parent=target.parent();if(target.is("span.object_list_option_button")){if(target_parent.is(".disabled")){return false}target_parent.toggleClass("opened");return false}if(target.is("input[type=radio]")){if(target.attr("icon")){var icon_parent=target.parents(".object_list_option.with_dropdown").find(".object_list_option_button");icon_parent.css("background-image","url("+target.attr("icon")+")")}if(target.is("input[name=grouping]")){if(target.val()){set_grouping.apply(_this,[target.val()]);set_cookie.apply($this,["grouping",target.val()])}else{remove_grouping.apply(_this);set_cookie.apply($this,["grouping",""])}}else{if(target.is(".filter")){if(target.val()){add_filter.apply(_this,[target.attr("name"),target.val()]);set_cookie.apply($this,["filtering_"+target.attr("name"),target.val()])}else{remove_filter.apply(_this,[target.attr("name")]);set_cookie.apply($this,["filtering_"+target.attr("name"),""])}breadcrumbs_update_last.apply(_this,[target.attr("breadcrumbs")])}}target.parents(".object_list_option.with_dropdown.opened").removeClass("opened")}});var resize_search_filter=function(){variables.objects_list_search_filter_parent.css("width",variables.objects_list_head.width()-variables.objects_list_options_parent.width())};resize_search_filter();App.Wireframe.Events.bind("window_resize",resize_search_filter);var up_down_timeout;var up_down_item_nav=function(event){var _this=this;var $this=$(this);var variables=_variables($this);var row=null;if(!App.canNavigateAway()){return false}if(event.keyCode==38){if(variables.objects_list_body.find("div.object_list_group_head.clickable.selected").length==1){var object_list_group=variables.objects_list_body.find("div.object_list_group_head.clickable.selected").parent();do{var object_list_group=object_list_group.prev();row=object_list_group.find("tr.objects_list_item:last");if(row.length==0){row=object_list_group.find("div.object_list_group_head.clickable")}}while(row.length==0&&object_list_group.length>0)}else{row=variables.objects_list_body.find("tr.objects_list_item.selected:first").prev();current_group_not_visible=variables.objects_list_body.find("tr.objects_list_item.selected:first").parents(":eq(2)").css("display")==="none";if(row.length==0||current_group_not_visible){var object_list_group=variables.objects_list_body.find("tr.objects_list_item.selected:first").parents(":eq(3)");if(object_list_group.find("div.object_list_group_head.clickable").length==1){row=object_list_group.find("div.object_list_group_head.clickable")}else{do{var object_list_group=object_list_group.prev();row=object_list_group.find("tr.objects_list_item:last");var group_not_visible=object_list_group.find(".object_list_group_body").css("display")==="none"}while((row.length==0||group_not_visible)&&object_list_group.length>0)}}}}else{if(event.keyCode==40){if(variables.objects_list_body.find("tr.objects_list_item.selected").length==0&&variables.objects_list_body.find("div.object_list_group_head.clickable.selected").length==0){if(variables.objects_list_body.find("div.object_list_group_head.clickable:first").length==1){row=variables.objects_list_body.find("div.object_list_group_head.clickable:first")}else{row=variables.objects_list_body.find("tr.objects_list_item:first")}}else{if(variables.objects_list_body.find("div.object_list_group_head.clickable.selected").length==1){var object_list_group=variables.objects_list_body.find("div.object_list_group_head.clickable.selected").parent();do{row=object_list_group.find("tr.objects_list_item:first");if(row.length==0){var object_list_group=object_list_group.next();row=object_list_group.find("div.object_list_group_head.clickable")}}while(row.length==0&&object_list_group.length>0)}else{row=variables.objects_list_body.find("tr.objects_list_item.selected:last").next();current_group_not_visible=variables.objects_list_body.find("tr.objects_list_item.selected:first").parents(":eq(2)").css("display")==="none";if(row.length==0||current_group_not_visible){var object_list_group=variables.objects_list_body.find("tr.objects_list_item.selected:last").parents(":eq(3)");if(object_list_group.next().find("div.object_list_group_head.clickable").length==1){row=object_list_group.next().find("div.object_list_group_head.clickable")}else{do{var object_list_group=object_list_group.next();row=object_list_group.find("tr.objects_list_item:first");var group_not_visible=object_list_group.find(".object_list_group_body").css("display")==="none"}while((row.length==0||group_not_visible)&&object_list_group.length>0)}}}}}}if(row&&row.length>0){if(up_down_timeout){clearInterval(up_down_timeout)}variables.objects_list_body.find("tr.objects_list_item.selected").removeClass("selected");variables.objects_list_body.find("div.object_list_group_head.clickable.selected").removeClass("selected");row.addClass("selected");mark_single_row.apply(_this,[row]);up_down_timeout=setTimeout(function(){trigger_event.apply(_this,["item_selected",[row]]);load_single.apply(_this,[row])},500)}};var search_timeout;var do_search=function(){var query=$.trim(variables.objects_list_search_filter.val());if(query){variables.objects_list_cancel_search_filter.show()}else{variables.objects_list_cancel_search_filter.hide()}if(query!=variables.active_search_query){variables.active_search_query=query;update_items_list.apply(_this,[false])}if(search_timeout){clearInterval(search_timeout)}};variables.objects_list_search_filter.bind("click keyup",function(event){if(event.type=="keyup"&&event.keyCode==27){variables.objects_list_cancel_search_filter.hide();variables.objects_list_search_filter.blur().attr("value","").focus();do_search()}else{if(event.type=="keyup"&&event.keyCode==13){do_search()}else{if(event.type=="keyup"&&(event.keyCode==40||event.keyCode==38)){up_down_item_nav.apply(_this,[event])}else{if(search_timeout){clearTimeout(search_timeout)}search_timeout=setTimeout(do_search,300)}}}});variables.objects_list_cancel_search_filter.click(function(){variables.objects_list_cancel_search_filter.hide();variables.objects_list_search_filter.blur().attr("value","").focus();do_search();return false});variables.objects_list_cancel_search_filter.hide();variables.objects_list_search_filter.focus()};var init_multi_form=function(){var _this=this;var $this=$(this);var variables=_variables($this);var multi_form_button=variables.multi_form.find(".button_holder button[type=submit]");variables.multi_form.click(function(event){var target=$(event.target);var target_cell=target.parents("td:first");if(target.is("input[type=checkbox]")&&target_cell.is(".checkbox")){var hidden_fields=target_cell.next("td.new_value").find("*");if(target.is(":checked")){multi_form_button.attr("disabled",false);hidden_fields.show()}else{if(!variables.multi_form.find("td.checkbox input[type=checkbox]:checked").length){multi_form_button.attr("disabled",true)}hidden_fields.hide()}}});variables.multi_form.submit(function(){data={selected_item_ids:[],actions:[],variables:{},objects_type:variables.settings.objects_type,submitted:"submitted"};variables.multi_form.find("td.checkbox input:checked").each(function(){var checkbox=$(this);var row=checkbox.parents("tr:first");data.actions.push(checkbox.attr("value"));row.find("td.new_value input:visible, td.new_value select:visible, td.new_value textarea:visible").each(function(){var field=$(this);if(field.is("[type=checkbox], [type=radio]")){if(field.is(":checked")){data.variables[field.attr("name")]=field.attr("value")}}else{data.variables[field.attr("name")]=field.attr("value")}})});variables.objects_list_body.find("tr.selected").each(function(){data.selected_item_ids.push(this.getAttribute("item_id"))});multi_form_button.attr("disabled",true);variables.multi_wrapper.find("form").block();$.ajax({type:"post",url:variables.settings.multi_url,data:data,success:function(response){var items_affected=[];$.each(response,function(index,item){update_item.apply(_this,[item,true,true]);items_affected.push(item)});update_items_list.apply(_this);if(response.length==1){App.Wireframe.Flash.success("One item updated")}else{App.Wireframe.Flash.success(":num items updated",{num:response.length})}App.Wireframe.Events.trigger(variables.settings.objects_type+"_mass_updated",{items:items_affected,actions:data.actions})},error:function(response){App.Wireframe.Flash.error(App.lang("Failed to update multiple ")+App.lang(variables.settings.objects_type))},complete:function(){multi_form_button.attr("disabled",false);variables.multi_wrapper.find("form").unblock()}});return false});variables.multi_wrapper.find("form.separate_actions button").click(function(){var button=$(this);if(button.attr("confirm")&&!confirm(button.attr("confirm"))){return false}var form=button.parents("form:first");data={selected_item_ids:[],actions:[button.attr("value")],variables:{},objects_type:variables.settings.objects_type,submitted:"submitted"};variables.objects_list_body.find("tr.selected").each(function(){data.selected_item_ids.push(this.getAttribute("item_id"))});variables.multi_wrapper.find("form").block();$.ajax({url:variables.settings.multi_url,type:"post",data:data,success:function(response){if(button.attr("after")=="delete"){$.each(response,function(index,item){delete_item.apply(_this,[item,true,true])})}else{$.each(response,function(index,item){update_item.apply(_this,[item,true,true])})}update_items_list.apply(_this);if(response.length==1){App.Wireframe.Flash.success("One item updated")}else{App.Wireframe.Flash.success(":num items updated",{num:response.length})}App.Wireframe.Events.trigger(variables.settings.objects_type+"_mass_updated",[null])},error:function(response){App.Wireframe.Flash.error(App.lang("Failed to update multiple ")+App.lang(variables.settings.objects_type))},complete:function(){variables.multi_wrapper.find("form").unblock()}});return false})};var draw_initial_wireframe=function(){var _this=this;var $this=$(this);var variables=_variables($this);$this.attr("list_id",variables.settings.id);$this.addClass("objects_list_wrapper");variables.objects_list=$('<div class="objects_list"><div class="objects_list_head"><div class="object_list_filter"><input type="text" /><img src="'+App.Wireframe.Utils.widgetImageUrl("cancel-search.png","objects_list","environment")+'" alt="x" /></div><div class="object_list_options"><ul></ul></div></div><div class="objects_list_body"></div></div>');$this.prepend(variables.objects_list);variables.objects_list_head=variables.objects_list.find(".objects_list_head:first");variables.objects_list_body=variables.objects_list.find(".objects_list_body:first");variables.objects_list_search_filter=variables.objects_list.find(".object_list_filter:first input:first");variables.objects_list_cancel_search_filter=variables.objects_list.find(".object_list_filter:first img:first");variables.objects_list_search_filter_parent=variables.objects_list_search_filter.parents(".object_list_filter:first");variables.objects_list_options=variables.objects_list.find(".object_list_options ul:first");variables.objects_list_options_parent=variables.objects_list_options.parents("div.object_list_options:first");variables.view_wrapper=$('<div class="objects_list_details"><div class="objects_list_details_empty_wrapper"></div><div class="objects_list_details_single_wrapper"></div><div class="objects_list_details_multi_wrapper"><div class="objects_list_title"></div></div></div>');$this.append(variables.view_wrapper);variables.empty_wrapper=variables.view_wrapper.find(".objects_list_details_empty_wrapper").append($this.find(".empty_content").detach());variables.single_wrapper=variables.view_wrapper.find(".objects_list_details_single_wrapper");variables.multi_wrapper=variables.view_wrapper.find(".objects_list_details_multi_wrapper");variables.multi_title=variables.multi_wrapper.find(".objects_list_title");var multi_actions=variables.settings.multi_actions;if(multi_actions&&!$.isEmptyObject(multi_actions)){var multiple=multi_actions.multiple;if(multiple&&!$.isEmptyObject(multiple)){var multiple_wrapper=$('<div class="group"><form class="objects_list_multi_actions_form multiple_actions" method="post" action="'+variables.settings.multi_url+'"><table class="objects_list_multi_actions"></table><input type="hidden" style="display: none" value="submitted" name="submitted"><div class="button_holder"><button disabled="disabled" type="submit" class="default"><span><span>'+App.lang("Update Selected Items")+"</span></span></button></div></form></div>").appendTo(variables.multi_wrapper);var multiple_wrapper_table=multiple_wrapper.find("table:first");$.each(multiple,function(action_name,data){multiple_wrapper_table.append('<tr><td class="checkbox"><label><input type="checkbox" value="'+action_name+'">'+data.title+'</label></td><td class="new_value">'+data.controls+"</td></tr>")})}var separate=multi_actions.separate;if(separate&&!$.isEmptyObject(separate)){var separate_wrapper=$('<div class="group"><form class="objects_list_multi_actions_form separate_actions" method="post" action="'+variables.settings.multi_url+'"><input type="hidden" style="display: none" value="submitted" name="submitted"></form></div>').appendTo(variables.multi_wrapper);var separate_count=0;$.each(separate,function(action_name,data){$('<div class="separate_action"><img src="'+data.icon+'" /><br /><button type="submit" name="action" value="'+action_name+'" after="'+data.after+'" confirm="'+(data.confirm?data.confirm:"")+'" objects="'+data.objects+'"><span><span>'+data.title+"</span></span></button></div>").appendTo(separate_wrapper.find("form:first"));separate_count++});separate_wrapper.find("div.separate_action").css("width",Math.floor(100/separate_count)+"%")}}else{variables.multi_wrapper.append('<div class="no_multi_actions">'+App.lang("There are no available actions to perform")+"</div>")}variables.multi_form=variables.multi_wrapper.find("form.multiple_actions:first");variables.empty_page_events=App.Wireframe.Events.backup(".single");init_multi_form.apply(_this)};var default_render_item=function(item){var _this=this;var $this=$(this);var variables=_variables($this);return"<td>"+App.clean(real_field_value(item,"name",variables.settings.field_map))+"</td>"};var default_render_group=function(group_id,group){return App.clean(group)};var get_item_search_index=function(item){var _this=this;var $this=$(this);var variables=_variables($this);var search_index="";if(variables.settings.search_index&&typeof variables.settings.search_index=="function"){search_index=variables.settings.search_index.apply(_this,[item])}else{search_index=App.clean(real_field_value(item,"name",variables.settings.field_map).toLowerCase())}return" "+$.trim(search_index.replace(/\"/g,""))+" "};var get_group_search_index=function(group){var _this=this;var $this=$(this);var variables=_variables($this);if(typeof(group)=="string"){return App.clean(group)}else{return App.clean(group.name)}};var real_field_value=function(item,field,map){if(map&&map[field]){var traverse=map[field].split(".");var field_value=item;$.each(traverse,function(index,subfield_name){if(subfield_name){field_value=field_value[subfield_name];if(field_value===""||field_value===null||field_value===undefined){field_value="";return false}}});return field_value}else{var field_value=item[field];if(field_value===""||field_value===null||field_value===undefined){field_value=""}return field_value}};var render_item=function(item){var _this=this;var $this=$(this);var variables=_variables($this);var pre_rendered=variables.settings.render_item.apply(_this,[item]);var row='<tr class="objects_list_item" item_id="'+item.id+'" permalink="'+(real_field_value(item,"permalink",variables.settings.field_map)?real_field_value(item,"permalink",variables.settings.field_map):"")+'"';if(variables.properties&&variables.properties.length){$.each(variables.properties,function(index,property){var property_value=real_field_value(item,property,variables.settings.field_map);if(!(property_value===""||property_value===null||property_value===undefined)){row+=" "+property+'="'+property_value+'" '}});row+='_search_index="'+get_item_search_index.apply(_this,[item]).toLowerCase()+'"'}row+=">"+pre_rendered;if(variables.settings.show_goto_arrow){row+='<td class="goto"><a href="'+(item.goto_url?item.goto_url:item.permalink)+'"><img src="'+App.Wireframe.Utils.imageUrl("layout/projects/go.png","system")+'" alt="&gt;" /></a></td>'}row+="</tr>";return row};var render_group=function(group_id,group_item,active_grouping){var _this=this;var rendered='<div class="object_list_group"><div class="object_list_group_head '+(active_grouping.clickable?"clickable":"")+'" '+(active_grouping.clickable?'permalink="'+group_item.permalink+'"':"")+' _search_index=" '+get_group_search_index.apply(_this,[group_item]).toLowerCase()+' " ';if(active_grouping.filters&&typeof(active_grouping.filters)=="object"&&active_grouping.filters.length){$.each(active_grouping.filters,function(index,filter){rendered+=filter+'="'+group_item[filter]+'"'})}rendered+=' group_id="'+group_id+'" grouping_property="'+active_grouping.property+'" item_id="'+group_id+'">';if(active_grouping.render_group&&typeof(active_grouping.render_group)=="function"){rendered+=active_grouping.render_group.apply(_this,[group_id,group_item])}else{rendered+=default_render_group.apply(_this,[group_id,group_item])}rendered+='</div><div class="object_list_group_body"><table cellspacing="0"><tbody></tbody></table></div></div>';return rendered};var update_items_list=function(preserve_collapsed_groups){preserve_collapsed_groups=typeof preserve_collapsed_groups!=="undefined"?preserve_collapsed_groups:true;var _this=this;var $this=$(this);var variables=_variables($this);var storage=_storage($this);var data=storage.items;var object_list_group_bodies=$("div.objects_list_wrapper").find("div.object_list_group_body");var collapsed_group_ids=[];if(object_list_group_bodies){object_list_group_bodies.each(function(){var objects_list_group=$(this);if(objects_list_group.is(":hidden")){collapsed_group_ids.push(objects_list_group.parent().find("div.object_list_group_head ").attr("group_id"))}})}if(variables.active_filters){var filter_query="tr";$.each(variables.active_filters,function(property,value){if(!(value===""||value===null||value===undefined)){filter_query+="["+property+'="'+value+'"]'}});var filtered_data=$("<div></div>").append(data.find(filter_query).clone())}else{var filtered_data=typeof(data)=="object"&&data?data.clone():null}var search_query="";if(variables.active_search_query){var active_search_query=$.trim(variables.active_search_query.toLowerCase().replace(/\"/g,""));$.each(active_search_query.split(" "),function(index,search_fragment){if(search_fragment){search_query+='[_search_index*="'+search_fragment+'"]'}});var filtered_data=$("<div></div>").append(filtered_data.find("tr"+search_query));variables.objects_list.addClass("search_mode")}else{variables.objects_list.removeClass("search_mode")}var updated_list=$("<div></div>");if(variables.active_grouping){var active_grouping;var default_grouping;App.each(variables.settings.grouping,function(index,grouping){if(grouping.property==variables.active_grouping){active_grouping=grouping;return false}});if(typeof(active_grouping)=="object"&&active_grouping&&active_grouping.map){var inverted_search="tr";App.each(active_grouping.map,function(property_value,group_item){var current_group=$(render_group.apply(_this,[property_value,group_item,active_grouping]));current_group.find("tbody").append(filtered_data.find("tr["+active_grouping.property+'="'+property_value+'"]'));inverted_search+="["+active_grouping.property+'!="'+property_value+'"]';updated_list.append(current_group);delete current_group});var data_found=filtered_data.find(inverted_search);if(data_found.length>0){var uncategorized_label=active_grouping.uncategorized_label?active_grouping.uncategorized_label:App.lang("Uncategorized");var current_group=$('<div class="object_list_group"><div class="object_list_group_head">'+uncategorized_label+'</div><div class="object_list_group_body"><table cellspacing="0"><tbody></tbody></table></div></div>');current_group.find("tbody").append(data_found);updated_list.append(current_group);delete current_group}}else{updated_list=$('<table cellspacing="0"></table>').append(filtered_data.html())}}else{updated_list=$('<table cellspacing="0"></table>').append(filtered_data.html())}variables.objects_list_body.empty().append(updated_list).disableSelection();if(variables.active_filters&&active_grouping&&active_grouping.filters&&typeof(active_grouping.filters)=="object"&&active_grouping.filters.length){var group_query="";$.each(active_grouping.filters,function(grouping_filter_index,grouping_filter){$.each(variables.active_filters,function(active_filter,active_filter_value){if((active_filter==grouping_filter)&&!(active_filter_value===""||active_filter_value===null||active_filter_value===undefined)){group_query+="["+active_filter+"="+active_filter_value+"]"}})});if(group_query){variables.objects_list_body.find("div.object_list_group div.object_list_group_head:visible:not("+group_query+")").each(function(){$(this).parent().hide()})}}if(variables.active_grouping&&(!active_grouping.show_empty||(active_grouping.searchable&&variables.active_search_query))){variables.objects_list_body.find("div.object_list_group:not(:has(tr.objects_list_item)) div.object_list_group_head").hide();variables.objects_list_body.find("div.object_list_group:not(:has(tr.objects_list_item)) div.object_list_group_body").hide()}if(active_grouping&&active_grouping.searchable&&variables.active_search_query){variables.objects_list_body.find("div.object_list_group:visible div.object_list_group_head"+search_query).show()}restore_selection.apply(_this);if(variables.settings.show_items_count==true){$("div.object_list_group").each(function(){var object_list_group=$(this);var list_group_items_count=object_list_group.find("table tbody").children().length;if(list_group_items_count>0){object_list_group.find("div.object_list_group_head").append('<span class="object_list_group_count">'+list_group_items_count+"</span>")}})}if(variables.settings.enable_group_collapsing==true){$("div.object_list_group").each(function(){var object_list_group=$(this);var object_list_group_head=object_list_group.find("div.object_list_group_head");object_list_group_head.prepend('<span class="object_list_group_collapsable expanded">&nbsp;</span>');if(preserve_collapsed_groups&&collapsed_group_ids.length){var object_list_group_body=object_list_group.find("div.object_list_group_body");if($.inArray(object_list_group_head.attr("group_id"),collapsed_group_ids)>-1&&object_list_group_body.find("tbody").children().length==0){object_list_group_body.hide();object_list_group_head.find("span.object_list_group_collapsable").removeClass("expanded").addClass("collapsed")}}object_list_group_head.click(function(event){var ctrlKey=$.platform.mac?event.metaKey:event.ctrlKey;var collapsable_span=object_list_group_head.find("span.object_list_group_collapsable");if(ctrlKey){var old_class,new_class;if(collapsable_span.hasClass("expanded")){old_class="expanded";new_class="collapsed";$("div.object_list_group_body").slideUp("fast")}else{old_class="collapsed";new_class="expanded";$("div.object_list_group_body").slideDown("fast")}$("div.object_list_group_head span.object_list_group_collapsable").removeClass(old_class).addClass(new_class)}else{object_list_group.find("div.object_list_group_body").slideToggle("fast");if(collapsable_span.hasClass("expanded")){collapsable_span.removeClass("expanded").addClass("collapsed")}else{collapsable_span.removeClass("collapsed").addClass("expanded")}}})})}delete updated_list;delete data;delete filtered_data};var trigger_event=function(event,event_arguments){var _this=this;var $this=$(this);var variables=_variables($this);if(!$.isArray(event_arguments)){if(event_arguments){event_arguments=[].push(event_arguments)}else{event_arguments=[]}}if(variables.settings.events[event]&&typeof variables.settings.events[event]=="function"){return variables.settings.events[event].apply(_this,event_arguments)}};var mark_single_row=function(item){var _this=this;var $this=$(this);var variables=_variables($this);var initial_offset=6;var item_height=parseInt(item.height());var viewport_height=parseInt(variables.objects_list_body.height());var current_scroll=variables.objects_list_body.scrollTop();var item_offset_top=0;if(item.offset()){item_offset_top=item.offset().top}var relative_offset=item_offset_top-variables.objects_list_body.offset().top+current_scroll;if(!((relative_offset>current_scroll)&&(relative_offset<current_scroll+viewport_height))){if(relative_offset>current_scroll+viewport_height){variables.objects_list_body.scrollTop(relative_offset-viewport_height+item_height+initial_offset)}else{if(relative_offset<current_scroll){variables.objects_list_body.scrollTop(relative_offset-item_height+initial_offset)}}}};var refresh=function(){var _this=this;var $this=$(this);var variables=_variables($this);if(!variables.settings.refresh_url){return false}var storage=_storage($this);var list_content=variables.objects_list_body.find(":first-child");list_content.hide();$this.addClass("refreshing");$.ajax({url:variables.settings.refresh_url,success:function(response){if(!response){response=[]}import_items.apply(_this,[response]);update_items_list.apply(_this,[false])},error:function(response){App.Wireframe.Flash.error("Failed to update item list")},complete:function(response){list_content.show();$this.removeClass("refreshing")}})};var reload_current=function(){var _this=this;var $this=$(this);var variables=_variables($this);var selected_item=variables.objects_list_body.find("tr.objects_list_item.selected");var selected_group=variables.objects_list_body.find(".object_list_group_head.clickable.selected:first");if(selected_item.length==1){do_load_single.apply(_this,[selected_item]);return true}else{if(selected_group.length){do_load_single.apply(_this,[selected_group]);return true}}return false};var is_selected=function(id){var $this=$(this);var variables=_variables($this);return variables.objects_list_body.find('tr.objects_list_item.selected[item_id="'+id+'"]').length>0};var is_loaded=function(id,is_group){var $this=$(this);var variables=_variables($this);return variables.loaded_item&&variables.loaded_item.item_id==id&&variables.loaded_item.is_group==is_group};var plugin_name="objectsList";var settings={items:null,show_goto_arrow:null,render_item:default_render_item,search_index:null,objects_type:null,group_by:null,show_items_count:true,enable_group_collapsing:true,multi_title:App.lang(":num Items Selected"),multi_url:"#",listen:{add:null,edit:null,"delete":null},events:{empty:null,single:null,multi:null,single_loaded:null,item_selected:null,item_deselected:null}};$.fn[plugin_name]=function(method){if(public_methods[method]){return public_methods[method].apply(this,Array.prototype.slice.call(arguments,1))}else{if(typeof method==="object"||!method){return public_methods.init.apply(this,arguments)}else{$.error("Method "+method+" does not exist on jQuery."+plugin_name)}}};var _variables=function(element){var variables=element.data(plugin_name+"Variables");if(variables){return variables}element.data(plugin_name+"Variables",{});return element.data(plugin_name+"Variables")};var _storage=function(element){var storage=element.data(plugin_name+"Storage");if(storage){return storage}element.data(plugin_name+"Storage",{});return element.data(plugin_name+"Storage")}})(jQuery);App.standardObjectsListEvents=function(){var title_snapshot=App.Wireframe.PageTitle.snapshot();return{empty:function(){App.Wireframe.PageTitle.snapshot(title_snapshot)},single:function(){},multi:function(){App.Wireframe.PageTitle.setClean("")}}};