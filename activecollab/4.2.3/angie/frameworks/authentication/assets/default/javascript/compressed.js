/* Minified: jquery.loginAsForm.js */
jQuery.fn.loginAsForm=function(s){var settings=jQuery.extend({href:null,title:null,error:null,error_event:"async_operation_error"},s);if(settings.width){if(parseInt(settings.width)==settings.width){settings.width=settings.width}else{settings.width_class=settings.width;settings.width=1000}}else{settings.width=1000}return this.each(function(){var element=$(this);element.click(function(){var dialog=App.widgets.FlyoutDialog.show({title:settings.title?settings.title:element.attr("title"),data:settings.href?settings.href:element.attr("href"),data_type:"url",min_height:"auto",width:settings.width,width_class:settings.width_class,success:function(){var dialog_content=$(this);if(dialog_content.is("form")){var form=dialog_content}else{var form=dialog_content.find("form:first")}var handle_success=function(response){if(typeof(response)=="object"&&response&&response.ajax_error){handle_error.apply(this,[response]);return false}App.widgets.FlyoutDialog.stopProcessing(dialog);App.widgets.FlyoutDialog.close(dialog);App.Wireframe.Flash.success("You have been logged in as :name. Please wait until interface is reloaded",{name:response.display_name});location.href=App.Config.get("homepage_url")};var handle_error=function(response){App.widgets.FlyoutDialog.stopProcessing(dialog);if(typeof(settings.error)=="function"){settings.error.apply(element[0],[response])}};form.submit(function(){if(form.is(".disabled")){form.removeClass("disabled");return false}App.widgets.FlyoutDialog.startProcessing(dialog);var options={url:form.attr("action"),type:"post",dataType:"json",defaultErrorHandler:settings.error_event,success:function(response){handle_success.apply(this,[response])},error:function(response){handle_error.apply(this,[response])}};$.ajax({url:form.attr("action"),type:"post",dataType:"json",defaultErrorHandler:settings.error_event,data:form.serialize(),success:function(response){handle_success.apply(this,[response])},error:function(response){handle_error.apply(this,[response])}});return false})}});return false})})};
