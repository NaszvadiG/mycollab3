(function($){var public_methods={init:function(options){return this.each(function(){var wrapper=$(this);var items={};App.each(options.items,function(index,item){items[item.id]=item});delete options.items;this.gv_data={settings:jQuery.extend({},settings,options),items:items};render_initial_wireframe.apply(this);import_playlist.apply(this);set_current_item.apply(this,[this.gv_data.settings.current_item]);handle_interaction.apply(this)})}};var render_initial_wireframe=function(){var wrapper=$(this).addClass("gallery_view");this.gv_data.attachment_meta=$('<div class="gallery_view_meta"></div>').appendTo(wrapper);this.gv_data.attachment_meta_filename=$('<div class="gallery_view_meta_detail gallery_view_meta_filename"></div>').appendTo(this.gv_data.attachment_meta);this.gv_data.attachment_meta_type=$('<div class="gallery_view_meta_detail gallery_view_meta_type"></div>').appendTo(this.gv_data.attachment_meta);this.gv_data.attachment_meta_size=$('<div class="gallery_view_meta_detail gallery_view_meta_size"></div>').appendTo(this.gv_data.attachment_meta);this.gv_data.attachment_download_button=$('<button class="default" href="#">'+App.lang("Download")+"</button>").appendTo(this.gv_data.attachment_meta).click(function(){window.open($(this).attr("href"));return false});this.gv_data.preview_canvas_wrapper=$('<table cellspacing="0" class="gallery_view_preview_canvas_wrapper"></table>').appendTo(wrapper);this.gv_data.preview_canvas=$('<td class="gallery_view_preview_canvas"></td>').appendTo($("<tr></tr>").appendTo(this.gv_data.preview_canvas_wrapper));this.gv_data.thumbnails_wrapper=$('<div class="gallery_view_thumbnails_wrapper"></div>').appendTo(wrapper);this.gv_data.thumbnails_table=$('<table class="gallery_view_thumbnails" cellspacing="0"></table>').appendTo(this.gv_data.thumbnails_wrapper);this.gv_data.thumbnails=$("<tr></tr>").appendTo(this.gv_data.thumbnails_table)};var import_playlist=function(){var wrapper_dom=this;this.gv_data.total_items=0;$.each(this.gv_data.items,function(index,item){wrapper_dom.gv_data.thumbnails.append('<td><a href="#" item_id="'+item.id+'" title="'+item.name+'"><img src="'+item.thumbnail_url+'"/></a></td>');wrapper_dom.gv_data.total_items++});this.gv_data.thumbnails_table.css("width",(this.gv_data.total_items*130)+"px");resize_elements.apply(this)};var set_current_item=function(item_id){var wrapper_dom=this;var current_item=this.gv_data.items[item_id];this.gv_data.attachment_meta_filename.text(App.lang("Filename :filename",{filename:current_item.name}));this.gv_data.attachment_meta_type.text(App.lang("Type :type",{type:current_item.type}));this.gv_data.attachment_meta_size.text(App.lang("Size :size",{size:current_item.size}));this.gv_data.preview_canvas.empty().addClass("loading");this.gv_data.thumbnails.find("td").removeClass("selected");this.gv_data.thumbnails.find('a[item_id="'+item_id+'"]').parent().addClass("selected");if(this.gv_data.loader){this.gv_data.loader.abort()}this.gv_data.loader=$.ajax({url:App.extendUrl(current_item.preview_url,{preview_width:this.gv_data.preview_canvas_wrapper.width()-20,preview_height:this.gv_data.preview_canvas_wrapper.height()-20}),success:function(response){wrapper_dom.gv_data.preview_canvas.append(response)},error:function(response){if(response.status){App.Wireframe.Flash.error("Failed to load preview")}},complete:function(response){wrapper_dom.gv_data.preview_canvas.removeClass("loading");wrapper_dom.gv_data.loader=null}});this.gv_data.attachment_download_button.attr("href",current_item.download_url)};var load_next=function(){var selected=this.gv_data.thumbnails.find("td.selected");var next=selected.next("td");if(next.length){set_current_item.apply(this,[next.find("a").attr("item_id")])}};var load_previous=function(){var selected=this.gv_data.thumbnails.find("td.selected");var previous=selected.prev("td");if(previous.length){set_current_item.apply(this,[previous.find("a").attr("item_id")])}};var reload_current=function(){var selected=this.gv_data.thumbnails.find("td.selected");if(selected.length){set_current_item.apply(this,[selected.find("a").attr("item_id")])}};var resize_elements=function(){var wrapper=$(this);this.gv_data.preview_canvas_wrapper.css("height",wrapper.height()-this.gv_data.thumbnails_wrapper.height()-this.gv_data.attachment_meta.height())};var handle_interaction=function(){var wrapper_dom=this;this.gv_data.thumbnails.on("click","td",function(event){set_current_item.apply(wrapper_dom,[$(this).find("a").attr("item_id")]);event.preventDefault()});App.Wireframe.Events.bind("window_resize."+this.gv_data.settings.event_scope,function(){resize_elements.apply(wrapper_dom)});App.Wireframe.Events.bind("window_resize_end."+this.gv_data.settings.event_scope,function(){reload_current.apply(wrapper_dom)});App.Wireframe.Events.bind("keydown."+this.gv_data.settings.event_scope,function(key_event){if($(wrapper_dom).is(":visible")){if(key_event.keyCode==39){load_next.apply(wrapper_dom)}else{if(key_event.keyCode==37){load_previous.apply(wrapper_dom)}}}})};var plugin_name="galleryView";var settings={event_scope:"single"};$.fn[plugin_name]=function(method){if(public_methods[method]){return public_methods[method].apply(this,Array.prototype.slice.call(arguments,1))}else{if(typeof method==="object"||!method){return public_methods.init.apply(this,arguments)}else{$.error("Method "+method+" does not exist in jQuery."+plugin_name)}}}})(jQuery);