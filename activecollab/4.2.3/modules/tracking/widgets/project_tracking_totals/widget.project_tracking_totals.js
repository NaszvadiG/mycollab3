(function($){var public_methods={init:function(options){return this.each(function(){wrapper=$(this);this.ptt_data={settings:jQuery.extend({},settings,options)};render_initial_table_wireframe.apply(this);render_totals.apply(this,[this.ptt_data.settings.totals]);handle_events.apply(this)})},refresh:function(){return this.each(function(){var wrapper_dom=this;$.ajax({url:wrapper_dom.ptt_data.settings.refresh_totals_url,type:"get",dataType:"json",success:function(response){render_totals.apply(wrapper_dom,[response.totals])},error:function(){App.Wireframe.Flash.error("Failed to refresh tracking object totals")}})})}};var render_initial_table_wireframe=function(){wrapper.append('<table class="common" cellspacing="0"><thead><tr><th>'+App.lang("This Week")+"</th><th>"+App.lang("This Month")+"</th><th>"+App.lang("Previous Week")+"</th><th>"+App.lang("Previous Month")+"</th><th>"+App.lang("All Time")+'</th></tr></thead><tbody><tr><td><div id="this_week" class="TimeRecord"></div><div id="this_week" class="Expense"></div></td><td><div id="this_month" class="TimeRecord"></div><div id="this_month" class="Expense"></div></td><td><div id="previous_week" class="TimeRecord"></div><div id="previous_week" class="Expense"></div></td><td><div id="previous_month" class="TimeRecord"></div><div id="previous_month" class="Expense"></div></td><td><div id="all_time" class="TimeRecord"></div><div id="all_time" class="Expense"></div></td></tr></tbody></table>')};var render_totals=function(totals){var wrapper_dom=this;App.each(totals,function(timespan,total){App.each(total,function(type,value){if(type=="TimeRecord"){value=App.hoursFormat(value)}else{if(type=="Expense"){value=App.moneyFormat(value,wrapper_dom.ptt_data.settings.currency,null,true)}}wrapper.find("table tbody td div[id="+timespan+"][class="+type+"]").html(value)})})};var handle_events=function(){var wrapper_dom=this;App.Wireframe.Events.bind("time_record_created.content time_record_updated.content project_time_updated.content project_time_deleted.content expense_created.content expense_updated.content project_expense_updated.content project_expense_deleted.content",function(event,tracking_object){if(wrapper_dom.ptt_data.settings.project_id!=tracking_object.project.id){return false}wrapper.projectTrackingTotals("refresh")})};var plugin_name="projectTrackingTotals";var wrapper;var settings={totals:null,project_id:null,currency:null,refresh_totals_url:null};$.fn[plugin_name]=function(method){if(public_methods[method]){return public_methods[method].apply(this,Array.prototype.slice.call(arguments,1))}else{if(typeof method==="object"||!method){return public_methods.init.apply(this,arguments)}else{$.error("Method "+method+" does not exist in jQuery."+plugin_name)}}}})(jQuery);