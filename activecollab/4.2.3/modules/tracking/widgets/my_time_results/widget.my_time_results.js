(function($){var public_methods={init:function(options){return this.each(function(){var wrapper=$(this);this.mtr_data={settings:jQuery.extend({},settings,options)};if(typeof(this.mtr_data.settings.records)=="object"&&this.mtr_data.settings.records){render_initial_wireframe.apply(this);render_results.apply(this,[this.mtr_data.settings.records]);handle_events.apply(this)}else{if(typeof(this.mtr_data.settings.no_projects_message)=="string"){wrapper.append("<p>"+App.clean(this.mtr_data.settings.no_projects_message)+"</p>")}}})},refresh:function(){return this.each(function(){var wrapper_dom=this;$.ajax({url:wrapper_dom.mtr_data.settings.refresh_url,type:"get",dataType:"json",success:function(response){render_results.apply(wrapper_dom,[response.records])},error:function(){App.Wireframe.Flash.error("Failed to refresh My Time widget data")}})})}};var render_initial_wireframe=function(){var wrapper_dom=this;var wrapper=$(wrapper_dom);var previous_week=$('<div class="previous_week">'+App.lang("Previous Week")+": </div>").appendTo(wrapper);$('<a href="'+App.extendUrl(wrapper_dom.mtr_data.settings.weekly_time_url,{week:"previous"})+'" class="sum"></a>').flyout({title:App.lang("Time Entries for Week: :week_start to :week_end",{week_start:wrapper_dom.mtr_data.settings.previous_week_data.week_start,week_end:wrapper_dom.mtr_data.settings.previous_week_data.week_end}),width:750}).appendTo(previous_week);$('<a href="'+App.extendUrl(wrapper_dom.mtr_data.settings.log_time_url,{week:"previous"})+'" class="log_time_button"><img src="'+App.Wireframe.Utils.imageUrl("icons/12x12/button-add.png","environment")+'" alt="" /></a>').flyoutForm({title:App.lang("Log Time"),width:300,success_event:"time_record_created"}).appendTo(previous_week);var current_week=$('<div class="current_week">'+App.lang("This Week")+": <br></div>").appendTo(wrapper);$('<a href="'+App.extendUrl(wrapper_dom.mtr_data.settings.weekly_time_url,{week:"current"})+'" class="sum"></a>').flyout({title:App.lang("Time Entries for Week: :week_start to :week_end",{week_start:wrapper_dom.mtr_data.settings.current_week_data.week_start,week_end:wrapper_dom.mtr_data.settings.current_week_data.week_end}),width:750}).appendTo(current_week);$('<a href="'+App.extendUrl(wrapper_dom.mtr_data.settings.log_time_url,{week:"current"})+'" class="log_time_button"><img src="'+App.Wireframe.Utils.imageUrl("icons/12x12/button-add.png","environment")+'" alt="" /></a>').flyoutForm({title:App.lang("Log Time"),width:300,success_event:"time_record_created"}).appendTo(current_week)};var render_results=function(records){var wrapper=$(this);App.each(records,function(week,record){if(typeof(record)=="object"&&!jQuery.isEmptyObject(record)){for(var user_email in record){wrapper.find("."+week+" a.sum").html(App.hoursFormat(record[user_email].time))}}})};var handle_events=function(){var wrapper_dom=this;var wrapper=$(wrapper_dom);App.Wireframe.Events.bind("time_record_created.content time_record_deleted.content",function(event,time_record){if(wrapper_dom.mtr_data.settings.selected_user_id!=time_record.user.id){return false}wrapper.myTimeResults("refresh")})};var plugin_name="myTimeResults";var settings={records:null,refresh_url:null,selected_user_id:null,previous_week_data:null,current_week_data:null,weekly_time_url:null,log_time_url:null,no_projects_message:App.lang("No projects in the database that selected user can see.")};$.fn[plugin_name]=function(method){if(public_methods[method]){return public_methods[method].apply(this,Array.prototype.slice.call(arguments,1))}else{if(typeof method==="object"||!method){return public_methods.init.apply(this,arguments)}else{$.error("Method "+method+" does not exist in jQuery."+plugin_name)}}}})(jQuery);