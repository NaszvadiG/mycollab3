jQuery.fn.invoiceNote=function(s,notes){var settings=jQuery.extend({label:App.lang("Invoice Note"),name:"invoice[note]",notes:[],value:null,required:false,notes:notes?notes:null},s);return this.each(function(){var wrapper=$(this).addClass("invoice_note");var textarea_id=wrapper.attr("id")+"_textarea";var default_note=null;var notes_map=new App.Map(settings.notes);if(settings.notes&&settings.notes.length){var select='<select class="invoice_note_from_template"><option value="">'+App.lang("-- From Template --")+'</option><option value=""></option>';App.each(notes_map,function(note_id,note){select+='<option value="'+note_id+'">'+App.clean(note.name)+"</option>";if(note.is_default){default_note=note_id}});select+="</select>"}else{var select=""}var select=$(select).appendTo(wrapper);var label=$("<label for="+textarea_id+' class="main_label">'+App.clean(settings.label)+": "+(settings.required?"*":"")+"</label>").appendTo(wrapper);var textarea=$('<textarea name="'+App.clean(settings.name)+'" cols="48" rows="10""></textarea>').appendTo(wrapper);select.change(function(){var note_id=$(this).val();if(notes_map.isset(note_id)){textarea.val(notes_map.get(note_id)["content"])}});if(settings.value){wrapper.find("textarea").val(settings.value)}else{if(settings.select_default&&default_note){select.val(default_note);select.change()}}})};