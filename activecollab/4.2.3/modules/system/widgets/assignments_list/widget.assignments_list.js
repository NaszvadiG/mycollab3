jQuery.fn.assignmentsList=function(s){var settings=jQuery.extend({assignments:null,labels:null,project_slugs:null,task_url:null,task_subtask_url:null,todo_url:null,todo_subtask_url:null,job_types:null,show_label_and_priority:true,show_group_headers:true,show_additional_column_label_in_header:false,show_assignment_type:false,additional_column_1:"none",additional_column_2:"none",show_no_assignments_message:false,no_assignments_message:App.lang("No assignments to show"),no_assignments_message_css_class:"empty_page",on_group_ready:null},s);return this.each(function(){var wrapper=$(this).addClass("assignments_list");if(settings.assignments instanceof App.Map&&settings.assignments.length){var render_label=function(label_id){return label_id&&typeof(settings.labels[label_id])=="object"?App.Wireframe.Utils.renderLabelTag(settings.labels[label_id]):""};var render_priority=function(priority_id){return App.Wireframe.Utils.renderPriority(priority_id,true)};var assignment_url=function(assignment,sufix){var project_slug=settings.project_slugs&&typeof(settings.project_slugs[assignment.project_id])=="string"?settings.project_slugs[assignment.project_id]:null;if(project_slug){if(assignment.type=="Task"){return settings.task_url.replace("--PROJECT_SLUG--",project_slug).replace("--TASK_ID--",assignment.task_id)}else{return settings.todo_url.replace("--PROJECT_SLUG--",project_slug).replace("--TODO_LIST_ID--",assignment.id)}}else{return"#"}};var subtask_url=function(assignment,subtask,sufix){var project_slug=settings.project_slugs&&typeof(settings.project_slugs[assignment.project_id])=="string"?settings.project_slugs[assignment.project_id]:null;if(project_slug){if(assignment.type=="Task"){return settings.task_subtask_url.replace("--PROJECT_SLUG--",project_slug).replace("--TASK_ID--",assignment.task_id).replace("--SUBTASK_ID--",subtask.id)}else{return settings.todo_subtask_url.replace("--PROJECT_SLUG--",project_slug).replace("--TODO_LIST_ID--",assignment.id).replace("--SUBTASK_ID--",subtask.id)}}else{return"#"}};var estimated_time=function(value,job_type_id,tracked_time){var job_type=null;if(job_type_id&&typeof(settings.job_types)=="object"&&settings.job_types){if(typeof(settings.job_types[job_type_id])!="undefined"&&settings.job_types[job_type_id]){job_type=settings.job_types[job_type_id]}}if(job_type){var text=App.lang(":hours of :job",{hours:App.hoursFormat(value),job:job_type})}else{var text=App.hoursFormat(value)}if(value&&tracked_time>value){return'<span style="color: red; font-weight: bold;">'+text+"</span>"}else{return text}};var columns_count=1;if(settings.show_label_and_priority){columns_count+=1}if(settings.additional_column_1){columns_count+=1}if(settings.additional_column_2){columns_count+=1}var additional_columns={additional_column_1:settings.additional_column_1,additional_column_2:settings.additional_column_2};App.each(settings.assignments,function(group_id,group_data){var group_wrapper=$('<div class="assignment_filter_result_group_wrapper"><div class="assignment_filter_result_group_inner_wrapper"><table class="common assignments" cellspacing="0"><tbody></tbody></table></div></div>').appendTo(wrapper);if(settings.show_group_headers){var group_label=typeof(group_data.label)=="string"?group_data.label:"--";if(settings.show_additional_column_label_in_header){var initial_colspan=columns_count;if(settings.additional_column_1){initial_colspan-=1}if(settings.additional_column_2){initial_colspan-=1}var header_cells='<th colspan="'+initial_colspan+'">'+App.clean(group_label)+"</th>";for(var additional_column in additional_columns){switch(additional_columns[additional_column]){case"assignee":header_cells+="<th>"+App.lang("Assignee")+"</th>";break;case"project":header_cells+="<th>"+App.lang("Project")+"</th>";break;case"milestone":header_cells+="<th>"+App.lang("Milestone")+"</th>";break;case"category":header_cells+="<th>"+App.lang("Category")+"</th>";break;case"created_on":header_cells+="<th>"+App.lang("Created On")+"</th>";break;case"created_by":header_cells+="<th>"+App.lang("Created By")+"</th>";break;case"due_on":header_cells+="<th>"+App.lang("Due on")+"</th>";break;case"completed_on":header_cells+="<th>"+App.lang("Completed On")+"</th>";break;case"estimated_time":header_cells+="<th>"+App.lang("Estimated Time")+"</th>";break;case"tracked_time":header_cells+="<th>"+App.lang("Tracked Time")+"</th>";break}}}else{var header_cells='<th colspan="'+columns_count+'">'+App.clean(group_label)+"</th>"}group_wrapper.find("table").prepend("<thead><tr>"+header_cells+"</tr></thead>")}var group_table_body=group_wrapper.find("tbody");App.each(group_data.assignments,function(assignment_id,assignment_data){var assignment_url_base=assignment_url(assignment_data);var classes="assignment";if(assignment_data.completed_on){classes+=" completed"}if(assignment_data.type=="Task"){var assignment_type="task"}else{var assignment_type="todo_list"}classes+=" "+assignment_type;var row='<tr class="'+classes+'" assignment_id="'+assignment_id+'"><td class="labels">';row+=render_label(assignment_data.label_id);row+='</td><td class="name">';if(assignment_type=="task"){if(settings.show_assignment_type){row+='<span class="object_type object_type_task">#'+assignment_data.task_id+"</span> "}if(assignment_data.priority!=0){row+=render_priority(assignment_data.priority)+" "}row+='<a href="'+assignment_url_base+'" class="assignment_name quick_view_item">'+App.clean(assignment_data.name)+"</a></td>"}else{if(settings.show_assignment_type){row+='<span class="object_type object_type_task">'+App.lang("Todo")+"</span>"}row+='<a href="'+assignment_url_base+'" class="assignment_name quick_view_item">'+App.clean(assignment_data.name)+"</a></td>"}for(var additional_column in additional_columns){if(additional_columns[additional_column]&&additional_columns[additional_column]!="none"){if(additional_columns[additional_column]=="estimated_time"){var additional_cell_attributes='estimated_time="'+(typeof(assignment_data.estimated_time)!="undefined"?assignment_data.estimated_time:"0")+'"'}else{if(additional_columns[additional_column]=="tracked_time"){var additional_cell_attributes='tracked_time="'+(typeof(assignment_data.tracked_time)!="undefined"?assignment_data.tracked_time:"0")+'"'}else{var additional_cell_attributes=""}}row+='<td class="additional_column '+additional_column+'" '+additional_cell_attributes+">";switch(additional_columns[additional_column]){case"assignee":if(assignment_type=="task"){if(assignment_data.assignee_id&&typeof(assignment_data.assignee)=="string"){row+=App.clean(assignment_data.assignee)}else{row+='<span class="empty">'+App.lang("Not Set")+"</span>"}}break;case"project":if(assignment_data.project_id&&typeof(assignment_data.project)=="string"){row+=App.clean(assignment_data.project)}else{row+='<span class="empty">'+App.lang("Unknown")+"</span>"}break;case"milestone":if(assignment_data.milestone_id&&typeof(assignment_data.milestone)=="string"){row+=App.clean(assignment_data.milestone)}else{row+='<span class="empty">'+App.lang("Not Set")+"</span>"}break;case"category":if(assignment_data.category_id&&typeof(assignment_data.category)=="string"){row+=App.clean(assignment_data.category)}else{row+='<span class="empty">'+App.lang("Not Set")+"</span>"}break;case"created_on":if(assignment_data.created_on&&typeof(assignment_data.created_on)=="object"){row+=App.clean(assignment_data.created_on["formatted_date_gmt"])}break;case"age":if(typeof(assignment_data.age)!="undefined"){if(assignment_data.age==1){row+=App.lang("One Day")}else{row+=App.lang(":num Days",{num:assignment_data.age})}}break;case"created_by":if(typeof(assignment_data.created_by)=="string"){row+=App.clean(assignment_data.created_by)}break;case"due_on":if(assignment_type=="task"){if(assignment_data.due_on&&typeof(assignment_data.due_on)=="object"){row+=App.clean(assignment_data.due_on["formatted_gmt"])}else{row+='<span class="empty">'+App.lang("Not Set")+"</span>"}}break;case"completed_on":if(assignment_type=="task"){if(assignment_data.completed_on&&typeof(assignment_data.completed_on)=="object"){row+=App.clean(assignment_data.completed_on["formatted_date_gmt"])}else{row+='<span class="empty">'+App.lang("Open")+"</span>"}}break;case"estimated_time":if(typeof(assignment_data.estimated_time)!="undefined"&&assignment_data.estimated_time>0){var job_type_id=typeof(assignment_data.estimated_job_type_id)!="undefined"?assignment_data.estimated_job_type_id:null;var tracked_time=typeof(assignment_data.tracked_time)!="undefined"?assignment_data.tracked_time:0;row+=estimated_time(assignment_data.estimated_time,job_type_id,tracked_time)}else{row+='<span class="empty">'+App.lang("Empty")+"</span>"}break;case"tracked_time":if(assignment_data.tracked_time&&typeof(assignment_data.tracked_time)=="number"){row+=App.hoursFormat(assignment_data.tracked_time)}else{row+='<span class="empty">'+App.lang("Empty")+"</span>"}break}row+="</td>"}}group_table_body.append(row+"</tr>");if(typeof(assignment_data.subtasks)!="undefined"&&jQuery.isArray(assignment_data.subtasks)){App.each(assignment_data.subtasks,function(subtask_id,subtask_data){var subtask_url_base=subtask_url(assignment_data,subtask_data);var classes="assignment subtask";if(subtask_data.completed_on){classes+=" completed"}var row='<tr class="'+classes+'" assignment_id="'+assignment_id+'" subtask_id="subtask_id"><td class="labels">';row+=render_label(subtask_data.label_id);row+='<td class="name"><span class="object_type object_type_subtask">'+App.lang("Subtask")+"</span> ";if(subtask_data.priority!=0){row+=render_priority(subtask_data.priority)+" "}row+='<a href="'+subtask_url_base+'" class="assignment_name quick_view_item">'+App.clean(subtask_data.body)+"</a></td>";for(var additional_column in additional_columns){if(additional_columns[additional_column]&&additional_columns[additional_column]!="none"){row+='<td class="additional_column '+additional_column+'">';switch(additional_columns[additional_column]){case"assignee":if(subtask_data.assignee_id&&typeof(subtask_data.assignee)=="string"){row+=App.clean(subtask_data.assignee)}else{row+='<span class="empty">'+App.lang("Not Set")+"</span>"}break;case"created_on":if(subtask_data.created_on&&typeof(subtask_data.created_on)=="object"){row+=App.clean(subtask_data.created_on["formatted_date_gmt"])}break;case"age":if(typeof(subtask_data.age)!="undefined"){if(subtask_data.age==1){row+=App.lang("One Day")}else{row+=App.lang(":num Days",{num:subtask_data.age})}}break;case"created_by":if(typeof(subtask_data.created_by)=="string"){row+=App.clean(subtask_data.created_by)}break;case"due_on":if(subtask_data.due_on&&typeof(subtask_data.due_on)=="object"){row+=App.clean(subtask_data.due_on["formatted_gmt"])}else{row+='<span class="empty">'+App.lang("Not Set")+"</span>"}break;case"completed_on":if(subtask_data.completed_on&&typeof(subtask_data.completed_on)=="object"){row+=App.clean(subtask_data.completed_on["formatted_date_gmt"])}else{row+='<span class="empty">'+App.lang("Open")+"</span>"}break}row+="</td>"}}row+="</tr>";group_table_body.append(row)})}});if(typeof(settings.on_group_ready)=="function"){settings.on_group_ready.apply(group_wrapper[0],[settings])}})}else{if(settings.show_no_assignments_message){wrapper.append('<p class="empty_page '+settings.no_assignments_message_css_class+'">'+App.clean(settings.no_assignments_message)+"</p>")}}})};